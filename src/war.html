<!DOCTYPE html>
<html>
<head>
	<title>Uvee War</title>
</head>
<script type="text/javascript" src="js/dimension.js"></script>
<script type="text/javascript" src="js/blot.js"></script>
<script type="text/javascript">

	var world;

	/**
	 * @param {World} world
	 * @param {UVEEWAR.Blot} blot
	 */
	function updateBlot(world, blot) {
		blot.location.add(blot.velocity);
		if (blot.location.x > world.size.x || blot.location.x < 0) {
			blot.velocity.x = -blot.velocity.x;
		}
		if (blot.location.y > world.size.y || blot.location.y < 0) {
			blot.velocity.y = -blot.velocity.y;
		}
	}

	function draw(context, blot) {
		context.strokeStyle = "#000000";
		context.fillStyle = "#FFFF00";
		context.beginPath();
		context.arc(blot.location.x, blot.location.y, blot.size / 2, 0, Math.PI * 2, true);
		context.closePath();
		context.stroke();
		context.fill();
	}

	function mainLoop() {
		world.update();
		world.draw();
		window.setTimeout(mainLoop, 10);
	}

	/**
	 * @param {CanvasRenderingContext2D} context
	 * @param {UVEEWAR.Dimension} size
	 * @constructor
	 */
	function World(context, size) {
		this.size = size;
		var blots = [];
		var me = this;

		this.addBlot = function (blot) {
			blots.push(blot);
		};

		this.update = function () {
			var i, j;
			var deadBlots = [];
			for (i = 0; i < blots.length; i++) {
				var blot = blots[i];
				var blotIsDead = false;
				for (j = i + 1; j < blots.length; j++) {
					var other = blots[j];
					if (blot.isCollided(other)) {
						blotIsDead = true;
						if (deadBlots.indexOf(i) == -1)
							deadBlots.push(i);
						if (deadBlots.indexOf(j) == -1)
							deadBlots.push(j);
					}
				}
				if (!blotIsDead)
					updateBlot(me, blot);
			}
			for (i = 0; i < deadBlots.length; i++) {
				blots.splice(deadBlots[i], 1);
			}
		};

		this.draw = function () {
			context.fillStyle = '#FFFFFF';
			context.fillRect(0, 0, me.size.x, me.size.y);

			for (var i = 0; i < blots.length; i++) {
				draw(context, blots[i]);
			}
		};
	}


	window.onload = function () {
		var worldSize = new UVEEWAR.Dimension(600, 400);

		canvas = document.getElementById('viewport');
		if (canvas.getContext) {
			canvas.width = worldSize.x;
			canvas.height = worldSize.y;

			world = new World(canvas.getContext('2d'), worldSize);

			for (var i = 0; i < 10; i++) {
				var blot = new UVEEWAR.Blot(new UVEEWAR.Dimension(i * 20, 0), 10);
				world.addBlot(blot);
			}

			mainLoop();
		} else {
			alert('Sorry, your browser does not support drawing to the canvas.')
		}
	};

</script>
<body>
<div>
	<canvas id="viewport" style="border: 1px solid black">
		<p>Sorry, your browser is not good enough.</p>
	</canvas>
</div>
</body>
</html>